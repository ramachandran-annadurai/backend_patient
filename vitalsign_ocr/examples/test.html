<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medication OCR API Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e8f4fd;
            border-radius: 10px;
            background: #f8fbfe;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input[type="file"],
        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input[type="file"]:focus,
        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e8f4fd;
        }

        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .extracted-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .result-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .confidence {
            display: inline-block;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .high-confidence {
            background: #27ae60;
        }
        
        .medium-confidence {
            background: #f39c12;
        }
        
        .low-confidence {
            background: #e74c3c;
        }

        .bbox {
            background: #e8f4fd;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            color: #2c3e50;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fcc;
            margin-top: 20px;
        }

        .success {
            background: #efe;
            color: #363;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #cfc;
            margin-top: 20px;
        }

        .sample-data {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .sample-data h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .sample-data p {
            color: #856404;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .copy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .copy-btn:hover {
            background: #229954;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Medication OCR API Test</h1>
            <p>Test the Medication OCR API with file uploads and base64 input</p>
        </div>

        <div class="content">
            <!-- Sample Data Section -->
            <div class="section">
                <h2>üìã Sample Prescription Data</h2>
                <div class="sample-data">
                    <h4>Sample OCR Response (67 text elements extracted):</h4>
                    <p>This sample shows a prescription template with patient information, medications, and physician details. The API successfully extracted 67 text elements with high confidence scores.</p>
                    <button class="copy-btn" onclick="copySampleData()">Copy Sample Data</button>
                    <button class="copy-btn" onclick="testSampleData()" style="background: #3498db; margin-left: 10px;">Test Sample Data</button>
                </div>
            </div>

            <!-- File Upload Section -->
            <div class="section">
                <h2>üìÅ File Upload Test</h2>
                <div class="form-group">
                    <label for="fileInput">Select Image or Document:</label>
                    <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx,.txt">
                </div>
                <button class="btn" onclick="testFileUpload()">Test Enhanced OCR Upload</button>
                <button class="btn btn-secondary" onclick="testStandardUpload()">Test Standard OCR Upload</button>
            </div>

            <!-- Base64 Input Section -->
            <div class="section">
                <h2>üî¢ Base64 Input Test</h2>
                <div class="form-group">
                    <label for="base64Input">Enter Base64 Encoded Image:</label>
                    <textarea id="base64Input" placeholder="Paste base64 encoded image data here..."></textarea>
                </div>
                <button class="btn" onclick="testBase64Enhanced()">Test OCR Base64</button>
                <button class="btn btn-secondary" onclick="loadSampleBase64()">Load Sample Base64</button>
            </div>

            <!-- Webhook Test Section -->
            <div class="section">
                <h2>üîó Webhook Configuration Test</h2>
                <div class="form-group">
                    <label for="webhookUrl">Webhook URL:</label>
                    <input type="text" id="webhookUrl" placeholder="https://webhook.site/your-unique-id">
                </div>
                <button class="btn" onclick="testWebhookConfig()">Test Webhook Configuration</button>
                <button class="btn btn-secondary" onclick="getWebhookConfigs()">Get All Webhooks</button>
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing your request...</p>
            </div>

            <!-- Results Section -->
            <div class="results" id="results" style="display: none;">
                <h3>üìä OCR Results</h3>
                <div id="responseStatsContainer"></div>
                <div id="extractedTextContainer"></div>
                <div id="webhookStatusContainer"></div>
                <div id="resultsGrid"></div>
            </div>

            <!-- Error/Success Messages -->
            <div id="messageContainer"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        
        // Sample base64 image (1x1 pixel)
        const SAMPLE_BASE64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';

        // Sample OCR response data with full extracted_text
        const SAMPLE_OCR_RESPONSE = {
            "success": true,
            "filename": "Screenshot 2025-08-16 141924.png",
            "text_count": 67,
            "extracted_text": "PRESCRIPTION TEMPLATE\nPrescription No. 0001\nPrescription Date November 8, 2021\nPatient Information\nName: Anne Burton\nAge: 30\nPhone Number: (123) 123-4567\nDate of Birth: Wednesday, November 8, 1989\nEmail: anne.burton@noemailtest.com\nGender: Female\nAddress: 1372 Payne Street, Richlands, VA, 24641\nAllergies: Seafood\nNotable Health Condition: None\nList of Prescribed Medications\nMedication Name: Expectorant, Purpose: Removes phlegm, Dosage: 1 tablet, Route: Oral, Frequency: Every 4 hours\nMedication Name: Paracetamol, Purpose: For fever, Dosage: 1 tablet, Route: Oral, Frequency: Every 4 hours\nMedication Name: Anti-biotic, Purpose: Bacterial infection, Dosage: 500mg, Route: Oral, Frequency: Every 8 hours\nMedication Name: Vitamin C, Purpose: Immune system, Dosage: 500mg, Route: Oral, Frequency: Once a day\nMedication Name: Vitamin D, Purpose: Immune System, Dosage: 1 tablet, Route: Oral, Frequency: Once a day\nPhysician Name: Leslie Holden\nPhysician Phone Number: (112) 312-3456\nPhysician Signature: As\nPhysician Email: leslie.h@noemail.com\nNovember 9, 2021",
            "full_content": "prescription or medication document containing 67 text elements with average confidence of 98.5%",
            "results": [
                {
                    "text": "PRESCRIPTION TEMPLATE",
                    "confidence": 0.9817286133766174,
                    "bbox": [[113, 31], [335, 31], [335, 46], [113, 46]]
                },
                {
                    "text": "Prescription No.",
                    "confidence": 0.9848132133483887,
                    "bbox": [[61, 71], [123, 71], [123, 82], [61, 82]]
                },
                {
                    "text": "0001",
                    "confidence": 0.9986476898193359,
                    "bbox": [[60, 84], [82, 84], [82, 96], [60, 96]]
                },
                {
                    "text": "November 8, 2021",
                    "confidence": 0.9994931221008301,
                    "bbox": [[225, 85], [297, 85], [297, 95], [225, 95]]
                },
                {
                    "text": "Patient Information",
                    "confidence": 0.9999281167984009,
                    "bbox": [[61, 108], [145, 108], [145, 119], [61, 119]]
                },
                {
                    "text": "Name: Anne Burton",
                    "confidence": 0.9998162984848022,
                    "bbox": [[60, 125], [112, 125], [112, 148], [60, 148]]
                },
                {
                    "text": "Age: 30",
                    "confidence": 0.9836610555648804,
                    "bbox": [[60, 125], [112, 125], [112, 148], [60, 148]]
                },
                {
                    "text": "Phone Number: (123) 123-4567",
                    "confidence": 0.9877447485923767,
                    "bbox": [[60, 153], [119, 153], [119, 177], [60, 177]]
                },
                {
                    "text": "Date of Birth: Wednesday, November 8, 1989",
                    "confidence": 0.975077748298645,
                    "bbox": [[224, 167], [347, 167], [347, 177], [224, 177]]
                },
                {
                    "text": "Email: anne.burton@noemailtest.com",
                    "confidence": 0.9938861131668091,
                    "bbox": [[61, 183], [181, 183], [181, 207], [61, 207]]
                },
                {
                    "text": "Gender: Female",
                    "confidence": 0.9966123700141907,
                    "bbox": [[224, 181], [256, 181], [256, 208], [224, 208]]
                },
                {
                    "text": "Address: 1372 Payne Street, Richlands, VA, 24641",
                    "confidence": 0.9952965974807739,
                    "bbox": [[59, 214], [141, 214], [141, 246], [59, 246]]
                },
                {
                    "text": "Allergies: Seafood",
                    "confidence": 0.9992453455924988,
                    "bbox": [[58, 251], [97, 251], [97, 279], [58, 279]]
                },
                {
                    "text": "Notable Health Condition: None",
                    "confidence": 0.9738696813583374,
                    "bbox": [[225, 254], [324, 254], [324, 280], [225, 280]]
                },
                {
                    "text": "List of Prescribed Medications",
                    "confidence": 0.9996507167816162,
                    "bbox": [[61, 289], [186, 289], [186, 301], [61, 301]]
                },
                {
                    "text": "Medication Name: Expectorant, Purpose: Removes phlegm, Dosage: 1 tablet, Route: Oral, Frequency: Every 4 hours",
                    "confidence": 0.9944614171981812,
                    "bbox": [[72, 311], [377, 311], [377, 348], [72, 348]]
                },
                {
                    "text": "Medication Name: Paracetamol, Purpose: For fever, Dosage: 1 tablet, Route: Oral, Frequency: Every 4 hours",
                    "confidence": 0.990095853805542,
                    "bbox": [[72, 311], [377, 311], [377, 362], [72, 362]]
                },
                {
                    "text": "Medication Name: Anti-biotic, Purpose: Bacterial infection, Dosage: 500mg, Route: Oral, Frequency: Every 8 hours",
                    "confidence": 0.9886342883110046,
                    "bbox": [[72, 311], [377, 311], [377, 382], [72, 382]]
                },
                {
                    "text": "Medication Name: Vitamin C, Purpose: Immune system, Dosage: 500mg, Route: Oral, Frequency: Once a day",
                    "confidence": 0.9990479946136475,
                    "bbox": [[72, 311], [377, 311], [377, 403], [72, 403]]
                },
                {
                    "text": "Medication Name: Vitamin D, Purpose: Immune System, Dosage: 1 tablet, Route: Oral, Frequency: Once a day",
                    "confidence": 0.9987873435020447,
                    "bbox": [[72, 311], [377, 311], [377, 417], [72, 417]]
                },
                {
                    "text": "Physician Name: Leslie Holden",
                    "confidence": 0.9964508414268494,
                    "bbox": [[61, 438], [115, 438], [115, 461], [61, 461]]
                },
                {
                    "text": "Physician Phone Number: (112) 312-3456",
                    "confidence": 0.9869160056114197,
                    "bbox": [[224, 437], [285, 437], [285, 461], [224, 461]]
                },
                {
                    "text": "Physician Signature: As",
                    "confidence": 0.9111484289169312,
                    "bbox": [[61, 467], [139, 467], [139, 500], [61, 500]]
                },
                {
                    "text": "Physician Email: leslie.h@noemail.com",
                    "confidence": 0.9758797883987427,
                    "bbox": [[224, 468], [310, 468], [310, 491], [224, 491]]
                },
                {
                    "text": "November 9, 2021",
                    "confidence": 0.9988369941711426,
                    "bbox": [[62, 514], [132, 514], [132, 525], [62, 525]]
                }
            ],
            "file_type": "IMAGE",
            "total_pages": 1,
            "processing_summary": {
                "total_pages": 1,
                "native_text_pages": 0,
                "ocr_pages": 1,
                "mixed_processing": false
            },
            "webhook_delivery": {
                "status": "completed",
                "results": [],
                "timestamp": "2025-08-26T10:20:02.756512"
            }
        };

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            clearMessage();
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showMessage(message, type = 'success') {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function clearMessage() {
            document.getElementById('messageContainer').innerHTML = '';
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const responseStatsContainer = document.getElementById('responseStatsContainer');
            const extractedTextContainer = document.getElementById('extractedTextContainer');
            const webhookStatusContainer = document.getElementById('webhookStatusContainer');
            const resultsGrid = document.getElementById('resultsGrid');

            // Display response statistics
            if (data.success) {
                const avgConfidence = data.results && data.results.length > 0 
                    ? (data.results.reduce((sum, r) => sum + (r.confidence || 0), 0) / data.results.length * 100).toFixed(1)
                    : 0;
                
                responseStatsContainer.innerHTML = `
                    <h4>üìà Response Statistics:</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <strong>Filename:</strong> ${data.filename || 'N/A'}
                        </div>
                        <div class="stat-item">
                            <strong>Text Count:</strong> ${data.text_count || 0}
                        </div>
                        <div class="stat-item">
                            <strong>File Type:</strong> ${data.file_type || 'N/A'}
                        </div>
                        <div class="stat-item">
                            <strong>Total Pages:</strong> ${data.total_pages || 1}
                        </div>
                        <div class="stat-item">
                            <strong>Average Confidence:</strong> ${avgConfidence}%
                        </div>
                        <div class="stat-item">
                            <strong>Processing Time:</strong> ${data.processing_time ? data.processing_time + 's' : 'N/A'}
                        </div>
                    </div>
                `;
            }

            // Display extracted text
            if (data.extracted_text) {
                extractedTextContainer.innerHTML = `
                    <h4>üìù Full Extracted Text:</h4>
                    <div class="extracted-text">${data.extracted_text}</div>
                `;
            }

            // Display webhook delivery status
            if (data.webhook_delivery) {
                const webhookStatus = data.webhook_delivery.status;
                const webhookTimestamp = data.webhook_delivery.timestamp;
                const statusClass = webhookStatus === 'completed' ? 'success' : 'error';
                
                webhookStatusContainer.innerHTML = `
                    <h4>üîó Webhook Delivery Status:</h4>
                    <div class="${statusClass}">
                        <strong>Status:</strong> ${webhookStatus.toUpperCase()}<br>
                        <strong>Timestamp:</strong> ${webhookTimestamp}<br>
                        <strong>Results:</strong> ${data.webhook_delivery.results ? data.webhook_delivery.results.length : 0} webhook(s) sent
                    </div>
                `;
            }

            // Display full content description
            if (data.full_content) {
                extractedTextContainer.innerHTML += `
                    <h4>üìã Content Summary:</h4>
                    <div class="extracted-text" style="background: #e8f5e8; border-left-color: #27ae60;">
                        ${data.full_content}
                    </div>
                `;
            }

            // Display individual results (limit to first 20 for better performance)
            if (data.results && data.results.length > 0) {
                const maxResults = Math.min(data.results.length, 20);
                let resultsHTML = `<h4>üîç Individual Text Elements (Showing first ${maxResults} of ${data.results.length}):</h4><div class="results-grid">`;
                
                data.results.slice(0, maxResults).forEach((result, index) => {
                    const confidencePercent = (result.confidence * 100).toFixed(1);
                    const confidenceClass = result.confidence >= 0.95 ? 'high-confidence' : 
                                         result.confidence >= 0.85 ? 'medium-confidence' : 'low-confidence';
                    
                    resultsHTML += `
                        <div class="result-item">
                            <h4>Text ${index + 1}</h4>
                            <div class="confidence ${confidenceClass}">Confidence: ${confidencePercent}%</div>
                            <p><strong>Text:</strong> ${result.text}</p>
                            <div class="bbox">
                                <strong>Bounding Box:</strong><br>
                                ${JSON.stringify(result.bbox, null, 2)}
                            </div>
                        </div>
                    `;
                });
                
                if (data.results.length > 20) {
                    resultsHTML += `
                        <div class="result-item" style="grid-column: 1 / -1; text-align: center; background: #f8f9fa;">
                            <p><em>... and ${data.results.length - 20} more text elements</em></p>
                            <button class="btn btn-secondary" onclick="showAllResults()">Show All Results</button>
                        </div>
                    `;
                }
                
                resultsHTML += '</div>';
                resultsGrid.innerHTML = resultsHTML;
            }

            resultsDiv.style.display = 'block';
        }

        async function testFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('Please select a file first.', 'error');
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/ocr/enhanced/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ File processed successfully! Extracted ${data.text_count} text elements.`);
                    displayResults(data);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        async function testStandardUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('Please select a file first.', 'error');
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/ocr/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ Standard OCR completed! Extracted ${data.text_count} text elements.`);
                    displayResults(data);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        async function testBase64Enhanced() {
            const base64Input = document.getElementById('base64Input').value.trim();
            
            if (!base64Input) {
                showMessage('Please enter base64 data first.', 'error');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/ocr/base64`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ image: base64Input })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ Base64 OCR completed! Extracted ${data.text_count} text elements.`);
                    displayResults(data);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        async function testBase64Standard() {
            const base64Input = document.getElementById('base64Input').value.trim();
            
            if (!base64Input) {
                showMessage('Please enter base64 data first.', 'error');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/ocr/base64`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ image: base64Input })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ Standard Base64 OCR completed! Extracted ${data.text_count} text elements.`);
                    displayResults(data);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        function loadSampleBase64() {
            document.getElementById('base64Input').value = SAMPLE_BASE64;
            showMessage('‚úÖ Sample base64 data loaded. This is a 1x1 pixel test image.');
        }

        async function testWebhookConfig() {
            const webhookUrl = document.getElementById('webhookUrl').value.trim();
            
            if (!webhookUrl) {
                showMessage('Please enter a webhook URL first.', 'error');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/webhook/configs`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: "Test Webhook",
                        url: webhookUrl,
                        enabled: true,
                        description: "Test webhook for OCR results",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        timeout: 30,
                        retry_attempts: 3,
                        retry_delay: 5
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ Webhook configuration created successfully! ID: ${data.id}`);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        async function getWebhookConfigs() {
            showLoading();

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/webhook/configs`);
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`‚úÖ Retrieved ${data.total} webhook configurations (${data.active_count} active)`);
                    console.log('Webhook configs:', data);
                } else {
                    showMessage(`‚ùå Error: ${data.detail || 'Unknown error occurred'}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        function copySampleData() {
            navigator.clipboard.writeText(JSON.stringify(SAMPLE_OCR_RESPONSE, null, 2))
                .then(() => showMessage('‚úÖ Sample data copied to clipboard!'))
                .catch(() => showMessage('‚ùå Failed to copy sample data', 'error'));
        }
        
        function showAllResults() {
            // This function would show all results in a modal or expand the current view
            showMessage('üîç Showing all results functionality would be implemented here');
        }
        
        function testSampleData() {
            // Display the sample data to show how it looks
            displayResults(SAMPLE_OCR_RESPONSE);
            showMessage('‚úÖ Sample data displayed! This shows the expected API response format.');
        }

        // Test API connection on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    showMessage('‚úÖ Connected to Medication OCR API successfully!');
                } else {
                    showMessage('‚ö†Ô∏è API responded but with an error status.', 'error');
                }
            } catch (error) {
                showMessage('‚ùå Cannot connect to Medication OCR API. Make sure the server is running on localhost:8000', 'error');
            }
        });
    </script>
</body>
</html>
